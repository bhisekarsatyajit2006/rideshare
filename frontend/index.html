<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TripSync - Smart, Safe & Affordable Rides</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* All your existing CSS styles remain exactly the same */
        :root {
            --primary: #14b8a6;
            --secondary: #0ea5e9;
            --accent: #10b981;
            --dark: #0f172a;
            --light: #f8fafc;
            --gray: #64748b;
            --white: #ffffff;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --gradient: linear-gradient(135deg, #14b8a6 0%, #0ea5e9 100%);
            --border-radius: 16px;
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --dark: #ffffff;
            --light: #0f172a;
            --white: #1e293b;
            --gray: #94a3b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: var(--light);
            transition: var(--transition);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        [data-theme="dark"] .header {
            background: rgba(30, 41, 59, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }

        .nav-link:hover {
            color: var(--primary);
            background: rgba(20, 184, 166, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            text-align: center;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--dark);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            color: var(--dark);
        }

        /* Main Content */
        .main {
            margin-top: 80px;
        }

        .page {
            display: none;
            min-height: calc(100vh - 80px);
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        /* Auth Page */
        .auth-container {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            background: var(--gradient);
        }

        .auth-box {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: 2.5rem;
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-radius: var(--border-radius);
            overflow: hidden;
            background: var(--light);
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .auth-tab.active {
            background: var(--primary);
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            color: var(--dark);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
        }

        /* Hero Section */
        .hero {
            background: var(--gradient);
            color: white;
            padding: 6rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            opacity: 0.9;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Stats Section */
        .stats {
            padding: 4rem 0;
            background: var(--white);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            text-align: center;
        }

        .stat-card {
            background: var(--light);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-weight: 600;
            color: var(--gray);
        }

        /* Features Section */
        .features {
            padding: 6rem 0;
            background: var(--light);
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--gray);
            max-width: 600px;
            margin: 0 auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .feature-card {
            background: var(--white);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 1rem;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .feature-card h3 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: var(--dark);
        }

        .feature-card p {
            color: var(--gray);
            line-height: 1.6;
        }

        /* How It Works Section */
        .how-it-works {
            padding: 6rem 0;
            background: var(--white);
        }

        .steps {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 2rem;
            margin-top: 3rem;
        }

        .step {
            flex: 1;
            min-width: 250px;
            text-align: center;
            position: relative;
        }

        .step-number {
            width: 60px;
            height: 60px;
            background: var(--gradient);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 auto 1.5rem;
        }

        .step h3 {
            margin-bottom: 1rem;
            color: var(--dark);
        }

        .step p {
            color: var(--gray);
        }

        /* Forms */
        .form-section {
            padding: 4rem 0;
        }

        .form-container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--white);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* Ride Cards */
        .rides-container {
            margin-top: 2rem;
        }

        .rides-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .rides-count {
            font-weight: 600;
            color: var(--gray);
        }

        .sort-select {
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: var(--white);
            color: var(--dark);
        }

        .rides-grid {
            display: grid;
            gap: 1.5rem;
        }

        .ride-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 4px solid var(--primary);
            position: relative;
        }

        .ride-card:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-lg);
        }

        .ride-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .ride-route {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
        }

        .ride-time {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 0.25rem;
        }

        .ride-price {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--accent);
        }

        .ride-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--light);
            border-radius: 8px;
        }

        .ride-detail {
            text-align: center;
        }

        .ride-detail-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ride-detail-value {
            font-weight: 600;
            color: var(--dark);
        }

        .driver-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: rgba(20, 184, 166, 0.05);
            border-radius: 8px;
        }

        .driver-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .driver-details h4 {
            margin-bottom: 0.25rem;
            color: var(--dark);
        }

        .driver-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
        }

        .rating {
            color: #fbbf24;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .verified-badge {
            background: var(--accent);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .amenities {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .amenity-tag {
            background: var(--light);
            border: 1px solid #e2e8f0;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--gray);
            font-weight: 500;
        }

        .ride-actions {
            display: flex;
            gap: 1rem;
            justify-content: space-between;
            align-items: center;
        }

        .ride-actions-left {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Map Container */
        .map-container {
            height: 400px;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            overflow: hidden;
            position: relative;
            border: 2px solid #e2e8f0;
        }

        .map-container .map-placeholder {
            height: 100%;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            border: 2px dashed #cbd5e1;
        }

        .map-placeholder::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="%2314b8a6" opacity="0.3"><animate attributeName="r" values="2;20;2" dur="3s" repeatCount="indefinite"/><animate attributeName="opacity" values="0.3;0;0.3" dur="3s" repeatCount="indefinite"/></circle></svg>');
            opacity: 0.5;
        }

        .map-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        /* Leaflet Map Styles */
        .leaflet-container {
            height: 100%;
            width: 100%;
            border-radius: var(--border-radius);
        }

        .leaflet-popup-content {
            margin: 8px 12px;
        }

        .leaflet-popup-content h3 {
            margin: 0 0 8px 0;
            color: var(--dark);
        }

        .leaflet-popup-content p {
            margin: 4px 0;
            color: var(--gray);
        }

        .leaflet-popup-content button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 8px;
        }

        /* Profile */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            background: var(--white);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: 800;
            position: relative;
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-avatar::after {
            content: '‚úì';
            position: absolute;
            bottom: -5px;
            right: -5px;
            width: 30px;
            height: 30px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            border: 3px solid var(--white);
        }

        .profile-info h2 {
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .profile-meta {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            margin-bottom: 1rem;
        }

        .profile-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .profile-badges {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .profile-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
        }

        .profile-badge.student {
            background: var(--accent);
        }

        .profile-badge.license {
            background: var(--primary);
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .profile-stat {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .profile-stat:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .profile-stat h3 {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .profile-stat p {
            color: var(--gray);
            font-weight: 500;
        }

        /* Filters */
        .filters {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .filters h3 {
            margin-bottom: 1rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--white);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            transform: translateX(400px);
            transition: var(--transition);
            z-index: 1001;
            border-left: 4px solid var(--primary);
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: var(--accent);
        }

        .notification.warning {
            border-left-color: #f59e0b;
        }

        .notification.error {
            border-left-color: #ef4444;
        }

        /* SOS Button */
        .sos-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: #ef4444;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: var(--transition);
        }

        .sos-btn:hover {
            transform: scale(1.1);
            background: #dc2626;
        }

        .sos-btn:active {
            animation: pulse 0.3s ease-out;
        }

        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 3rem 0 1rem;
            margin-top: 3rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 0.5rem;
        }

        .footer-links a {
            color: var(--gray);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--white);
                flex-direction: column;
                padding: 1rem;
                box-shadow: var(--shadow-lg);
                border-radius: 0 0 var(--border-radius) var(--border-radius);
            }

            .nav-links.show {
                display: flex;
            }

            .mobile-menu-btn {
                display: block;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: stretch;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .ride-details {
                grid-template-columns: 1fr 1fr;
            }

            .ride-actions {
                flex-direction: column;
                gap: 0.5rem;
            }

            .ride-actions-left {
                width: 100%;
                justify-content: center;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .driver-info {
                flex-direction: column;
                text-align: center;
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .steps {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 15px;
            }

            .hero {
                padding: 4rem 0;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .form-container {
                padding: 1.5rem;
            }

            .ride-card {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .notification {
                right: 15px;
                left: 15px;
                max-width: none;
                transform: translateY(-100px);
            }

            .notification.show {
                transform: translateY(0);
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        .slide-in {
            animation: slideIn 0.5s ease-out;
        }

        /* Loading States */
        .loading {
            position: relative;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--primary);
            border-right-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--gray);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Tracking Styles */
        .tracking-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
            padding: 1rem;
            background: var(--light);
            border-radius: var(--border-radius);
        }

        .tracking-stat {
            text-align: center;
        }

        .tracking-stat-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tracking-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        .tracking-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Notification Animations */
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .notification-container {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
        }

        .notification {
            animation: slideInRight 0.3s ease-out;
        }

        .notification.success {
            border-left-color: #10b981 !important;
        }

        .notification.error {
            border-left-color: #ef4444 !important;
        }

        .notification.warning {
            border-left-color: #f59e0b !important;
        }

        .notification.info {
            border-left-color: #0ea5e9 !important;
        }
    </style>
</head>
<body>
    <!-- Auth Page (shown first) -->
    <div id="auth-page" class="page active">
        <div class="auth-container">
            <div class="auth-box">
                <h2 style="margin-bottom: 1.5rem; color: var(--dark);">Welcome to TripSync</h2>
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                    <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
                </div>
                
                <!-- Login Form -->
                <form id="login-form" class="auth-form active">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="login-email" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="login-password" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                </form>
                
                <!-- Sign Up Form -->
                <form id="signup-form" class="auth-form">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" id="signup-name" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="signup-email" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="tel" class="form-input" id="signup-phone" placeholder="Enter your phone number" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">University/Workplace</label>
                        <input type="text" class="form-input" id="signup-workplace" placeholder="Enter your university or workplace" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="signup-password" placeholder="Create a password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" class="form-input" id="signup-confirm-password" placeholder="Confirm your password" required>
                    </div>
                    
                    <!-- Emergency Contacts -->
                    <div class="form-group">
                        <label class="form-label">Emergency Contact 1</label>
                        <div class="form-row">
                            <input type="text" class="form-input" id="emergency1-name" placeholder="Name" required>
                            <input type="tel" class="form-input" id="emergency1-phone" placeholder="Phone" required>
                        </div>
                        <input type="text" class="form-input" id="emergency1-relation" placeholder="Relationship (e.g., Parent, Friend)" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Emergency Contact 2 (Optional)</label>
                        <div class="form-row">
                            <input type="text" class="form-input" id="emergency2-name" placeholder="Name">
                            <input type="tel" class="form-input" id="emergency2-phone" placeholder="Phone">
                        </div>
                        <input type="text" class="form-input" id="emergency2-relation" placeholder="Relationship">
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">Create Account</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Header (shown after login) -->
    <header class="header" style="display: none;">
        <div class="container">
            <nav class="nav">
                <div class="logo" onclick="showPage('home')">üöó TripSync</div>
                <ul class="nav-links" id="nav-links">
                    <li><a href="#" class="nav-link" onclick="showPage('home')">Home</a></li>
                    <li><a href="#" class="nav-link" onclick="showPage('find-ride')">Find Ride</a></li>
                    <li><a href="#" class="nav-link" onclick="showPage('offer-ride')">Offer Ride</a></li>
                    <li><a href="#" class="nav-link" onclick="showPage('profile')">Profile</a></li>
                    <li><button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">üåô</button></li>
                    <li><a href="#" class="btn btn-secondary" onclick="logout()">Logout</a></li>
                </ul>
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">‚ò∞</button>
            </nav>
        </div>
    </header>

    <!-- Main Content (shown after login) -->
    <main class="main" style="display: none;">
        <!-- Home Page -->
        <div id="home" class="page active">
            <!-- Hero Section -->
            <section class="hero">
                <div class="container">
                    <div class="hero-content fade-in">
                        <h1>Smart, Safe & Affordable Rides</h1>
                        <p>Connect with trusted riders in your community. Share rides, save money, and reduce your carbon footprint with our eco-friendly ride-sharing platform.</p>
                        <div class="hero-buttons">
                            <a href="#" class="btn btn-primary" onclick="showPage('find-ride')">üîç Find a Ride</a>
                            <a href="#" class="btn btn-secondary" onclick="showPage('offer-ride')">üöô Offer a Ride</a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Stats Section -->
            <section class="stats">
                <div class="container">
                    <div class="stats-grid">
                        <div class="stat-card fade-in">
                            <div class="stat-number" data-count="Upcoming">0</div>
                            <div class="stat-label">Active Users</div>
                        </div>
                        <div class="stat-card fade-in">
                            <div class="stat-number" data-count="Upcoming">0</div>
                            <div class="stat-label">Rides Completed</div>
                        </div>
                        <div class="stat-card fade-in">
                            <div class="stat-number" data-count="Upcoming">0</div>
                            <div class="stat-label">Money Saved (‚Çπ)</div>
                        </div>
                        <!-- <div class="stat-card fade-in">
                            <div class="stat-number" data-count="850000">0</div>
                            <div class="stat-label">CO‚ÇÇ Reduced (kg)</div>
                        </div> -->
                    </div>
                </div>
            </section>

            <!-- Features Section -->
            <section class="features">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title">Why Choose TripSync?</h2>
                        <p class="section-subtitle">Experience the future of sustainable transportation with our innovative ride-sharing platform.</p>
                    </div>
                    <div class="features-grid">
                        <div class="feature-card fade-in">
                            <div class="feature-icon">üõ°Ô∏è</div>
                            <h3>Safety First</h3>
                            <p>Verified profiles, real-time tracking, SOS button, and 24/7 support for your peace of mind.</p>
                        </div>
                        <div class="feature-card fade-in">
                            <div class="feature-icon">üí∞</div>
                            <h3>Save Money</h3>
                            <p>Split fuel costs and save up to 60% on your daily commute. Smart pricing for everyone.</p>
                        </div>
                        <div class="feature-card fade-in">
                            <div class="feature-icon">üå±</div>
                            <h3>Eco-Friendly</h3>
                            <p>Reduce carbon emissions by sharing rides. Be part of the sustainable transport revolution.</p>
                        </div>
                        <div class="feature-card fade-in">
                            <div class="feature-icon">‚ö°</div>
                            <h3>Instant Matching</h3>
                            <p>AI-powered matching system finds you the perfect ride partner in seconds.</p>
                        </div>
                        <div class="feature-card fade-in">
                            <div class="feature-icon">üì±</div>
                            <h3>Easy to Use</h3>
                            <p>Intuitive interface designed for students and professionals. Book rides in 3 taps.</p>
                        </div>
                        <div class="feature-card fade-in">
                            <div class="feature-icon">‚≠ê</div>
                            <h3>Trusted Community</h3>
                            <p>Rating system and verified accounts ensure you ride with trusted community members.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- How It Works Section -->
            <section class="how-it-works">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title">How It Works</h2>
                        <p class="section-subtitle">Get started with TripSync in just a few simple steps</p>
                    </div>
                    <div class="steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <h3>Create an Account</h3>
                            <p>Sign up with your details and get verified as a student or professional.</p>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <h3>Find or Offer a Ride</h3>
                            <p>Search for available rides or offer your own ride to fellow commuters.</p>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <h3>Connect & Confirm</h3>
                            <p>Connect with your ride partner, confirm details, and agree on pickup points.</p>
                        </div>
                        <div class="step">
                            <div class="step-number">4</div>
                            <h3>Travel & Share</h3>
                            <p>Enjoy your journey, share costs, and rate your experience afterwards.</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Find Ride Page -->
        <div id="find-ride" class="page">
            <section class="form-section">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title">Find Your Perfect Ride</h2>
                        <p class="section-subtitle">Search for available rides in your area and connect with fellow travelers.</p>
                    </div>

                    <!-- Search Form -->
                    <div class="form-container">
                        <form id="search-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">From</label>
                                    <input type="text" class="form-input" id="search-from" placeholder="Enter pickup location" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">To</label>
                                    <input type="text" class="form-input" id="search-to" placeholder="Enter destination" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-input" id="search-date" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Time</label>
                                    <input type="time" class="form-input" id="search-time" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary" style="width: 100%;">üîç Search Rides</button>
                            </div>
                        </form>
                    </div>

                    <!-- Filters -->
                    <div class="filters">
                        <h3>üéõÔ∏è Filter Options</h3>
                        <div class="filter-grid">
                            <div class="form-group">
                                <label class="form-label">Vehicle Type</label>
                                <select class="form-input" id="filter-vehicle">
                                    <option value="">Any</option>
                                    <option value="hatchback">Hatchback</option>
                                    <option value="sedan">Sedan</option>
                                    <option value="suv">SUV</option>
                                    <option value="bike">Bike</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Gender Preference</label>
                                <select class="form-input" id="filter-gender">
                                    <option value="">Any</option>
                                    <option value="male">Male Only</option>
                                    <option value="female">Female Only</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Max Price (‚Çπ)</label>
                                <input type="number" class="form-input" id="filter-price" placeholder="500">
                            </div>
                        </div>
                        <div style="margin-top: 1rem;">
                            <button class="btn btn-secondary" onclick="applyFilters()">Apply Filters</button>
                            <button class="btn btn-secondary" onclick="clearFilters()" style="margin-left: 0.5rem;">Clear All</button>
                        </div>
                    </div>

                    <!-- Map -->
                    <div class="map-container" id="map-container">
                        <div id="map"></div>
                        <div id="map-placeholder" class="map-placeholder">
                            <div class="map-icon">üó∫Ô∏è</div>
                            <p><strong>Interactive Map</strong></p>
                            <p>Available rides and route visualization will be shown here</p>
                            <small>Using OpenStreetMap for reliable service</small>
                        </div>
                    </div>

                    <!-- Available Rides -->
                    <div class="rides-container">
                        <div class="rides-header">
                            <div class="rides-count" id="rides-count">Enter search criteria to find rides</div>
                            <select class="sort-select" id="sort-rides" onchange="sortRides()">
                                <option value="price-low">Price: Low to High</option>
                                <option value="price-high">Price: High to Low</option>
                                <option value="time">Departure Time</option>
                                <option value="rating">Highest Rated</option>
                            </select>
                        </div>
                        <div class="rides-grid" id="rides-list">
                            <!-- Rides will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Offer Ride Page -->
        <div id="offer-ride" class="page">
            <section class="form-section">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title">Offer a Ride</h2>
                        <p class="section-subtitle">Share your journey and help fellow commuters while earning some extra money.</p>
                    </div>

                    <div class="form-container">
                        <form id="offer-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Starting Location</label>
                                    <input type="text" class="form-input" id="offer-from" placeholder="Enter starting location" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Destination</label>
                                    <input type="text" class="form-input" id="offer-to" placeholder="Enter destination" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-input" id="offer-date" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Departure Time</label>
                                    <input type="time" class="form-input" id="offer-time" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Available Seats</label>
                                    <select class="form-input" id="offer-seats" required>
                                        <option value="">Select seats</option>
                                        <option value="1">1 seat</option>
                                        <option value="2">2 seats</option>
                                        <option value="3">3 seats</option>
                                        <option value="4">4 seats</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Price per Seat (‚Çπ)</label>
                                    <input type="number" class="form-input" id="offer-price" placeholder="200" min="50" max="1000" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Vehicle Type</label>
                                    <select class="form-input" id="offer-vehicle" required>
                                        <option value="">Select vehicle</option>
                                        <option value="hatchback">Hatchback</option>
                                        <option value="sedan">Sedan</option>
                                        <option value="suv">SUV</option>
                                        <option value="bike">Bike/Scooter</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Vehicle Number</label>
                                    <input type="text" class="form-input" id="offer-vehicle-number" placeholder="MH 01 AB 1234" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Additional Notes</label>
                                <textarea class="form-input" id="offer-notes" rows="3" placeholder="Any specific instructions, preferred pickup points, or passenger preferences..."></textarea>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary" style="width: 100%;">üöó Publish Ride</button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
        </div>

        <!-- Profile Page -->
        <div id="profile" class="page">
            <section class="form-section">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title">Your Profile</h2>
                        <p class="section-subtitle">Manage your profile and track your ride statistics.</p>
                    </div>

                    <!-- Profile Header -->
                    <div class="profile-header">
                        <div class="profile-avatar" id="profile-avatar-container">
                            <!-- Avatar will be set by JavaScript -->
                        </div>
                        <div class="profile-info">
                            <h2 id="profile-name">User Name</h2>
                            <div class="profile-meta">
                                <div class="profile-meta-item">
                                    <span>üìß</span>
                                    <span id="profile-email">user@example.com</span>
                                </div>
                                <div class="profile-meta-item">
                                    <span>üéì</span>
                                    <span id="profile-workplace">University/Workplace</span>
                                </div>
                                <div class="profile-meta-item">
                                    <span>üìû</span>
                                    <span id="profile-phone">+91 9876543210</span>
                                </div>
                                <div class="profile-meta-item">
                                    <span>‚≠ê</span>
                                    <span>Rating: 4.8/5 (127 reviews)</span>
                                </div>
                            </div>
                            <div class="profile-badges">
                                <span class="profile-badge student">‚úì Student Verified</span>
                                <span class="profile-badge license">‚úì License Verified</span>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Stats -->
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <h3 id="profile-offered">0</h3>
                            <p>Rides Offered</p>
                        </div>
                        <div class="profile-stat">
                            <h3 id="profile-taken">0</h3>
                            <p>Rides Taken</p>
                        </div>
                        <div class="profile-stat">
                            <h3 id="profile-saved">‚Çπ0</h3>
                            <p>Money Saved</p>
                        </div>
                    </div>

                    <!-- Profile Form -->
                    <div class="form-container">
                        <h3 style="margin-bottom: 1.5rem;">Update Profile Information</h3>
                        <form id="profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" class="form-input" id="profile-name-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-input" id="profile-email-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" class="form-input" id="profile-phone-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">University/Workplace</label>
                                    <input type="text" class="form-input" id="profile-workplace-input">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Bio</label>
                                <textarea class="form-input" id="profile-bio" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">Update Profile</button>
                                <button type="button" class="btn btn-secondary" onclick="shareProfile()" style="margin-left: 0.5rem;">Share Profile</button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>TripSync</h3>
                    <p>Smart, Safe & Affordable Rides for students and commuters.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#" onclick="showPage('home')">Home</a></li>
                        <li><a href="#" onclick="showPage('find-ride')">Find a Ride</a></li>
                        <li><a href="#" onclick="showPage('offer-ride')">Offer a Ride</a></li>
                        <li><a href="#" onclick="showPage('profile')">Profile</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Support</h3>
                    <ul class="footer-links">
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Safety Tips</a></li>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Legal</h3>
                    <ul class="footer-links">
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Cookie Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                &copy; 2023 TripSync. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- SOS Button -->
    <button class="sos-btn" onclick="triggerSOS()" title="Emergency SOS" aria-label="Emergency SOS Button" style="display: none;">SOS</button>

    <!-- Notification -->
    <div id="notification" class="notification">
        <div id="notification-message"></div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // Global variables
    let currentUser = null;
    let currentRides = [];
    let filteredRides = [];
    let map;
    let markers = [];

    // Authentication Class
    class Auth {
        constructor() {
            this.token = localStorage.getItem('TripSync_token');
            this.user = JSON.parse(localStorage.getItem('TripSync_user') || 'null');
            this.apiBase = 'http://localhost:5001/api';
        }

        setAuth(token, user) {
            this.token = token;
            this.user = user;
            localStorage.setItem('TripSync_token', token);
            localStorage.setItem('TripSync_user', JSON.stringify(user));
        }

        clearAuth() {
            this.token = null;
            this.user = null;
            localStorage.removeItem('TripSync_token');
            localStorage.removeItem('TripSync_user');
        }

        isAuthenticated() {
            return !!this.token && !!this.user;
        }

        getAuthHeaders() {
            return {
                'Authorization': `Bearer ${this.token}`,
                'Content-Type': 'application/json'
            };
        }

        async apiRequest(url, options = {}) {
            try {
                const response = await fetch(`${this.apiBase}${url}`, {
                    headers: this.getAuthHeaders(),
                    ...options
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'API request failed');
                }

                return data;
            } catch (error) {
                console.error('API request error:', error);
                throw error;
            }
        }

        async register(userData) {
            try {
                console.log('Sending registration data:', userData);
                const response = await fetch(`${this.apiBase}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const data = await response.json();
                console.log('Registration response:', data);

                if (!response.ok) {
                    throw new Error(data.message || 'Registration failed');
                }

                if (data.success) {
                    this.setAuth(data.token, data.user);
                }

                return data;
            } catch (error) {
                console.error('Registration error:', error);
                throw error;
            }
        }

        async login(email, password) {
            try {
                const response = await fetch(`${this.apiBase}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'Login failed');
                }

                if (data.success) {
                    this.setAuth(data.token, data.user);
                }

                return data;
            } catch (error) {
                console.error('Login error:', error);
                throw error;
            }
        }

        async getCurrentUser() {
            if (!this.isAuthenticated()) {
                return null;
            }

            try {
                const data = await this.apiRequest('/auth/me');
                if (data.success) {
                    this.user = data.user;
                    localStorage.setItem('TripSync_user', JSON.stringify(data.user));
                }
                return data.user;
            } catch (error) {
                console.error('Get user error:', error);
                this.clearAuth();
                return null;
            }
        }

        async updateProfile(profileData) {
            try {
                const data = await this.apiRequest('/auth/profile', {
                    method: 'PUT',
                    body: JSON.stringify(profileData)
                });

                if (data.success) {
                    this.user = data.user;
                    localStorage.setItem('TripSync_user', JSON.stringify(data.user));
                }

                return data;
            } catch (error) {
                console.error('Update profile error:', error);
                throw error;
            }
        }

        logout() {
            this.clearAuth();
            showNotification('Logged out successfully', 'info');
        }
    }

    // Ride Manager Class
    class RideManager {
        constructor() {
            this.apiBase = 'http://localhost:5001/api';
        }

        async createRide(rideData) {
            try {
                console.log('Creating ride:', rideData);
                const response = await fetch(`${this.apiBase}/rides`, {
                    method: 'POST',
                    headers: auth.getAuthHeaders(),
                    body: JSON.stringify(rideData)
                });

                const data = await response.json();
                console.log('Create ride response:', data);

                if (!response.ok) {
                    throw new Error(data.message || 'Failed to create ride');
                }

                return data;
            } catch (error) {
                console.error('Create ride error:', error);
                throw error;
            }
        }

        async searchRides(searchParams) {
            try {
                const queryParams = new URLSearchParams(searchParams).toString();
                console.log('Searching rides with params:', searchParams);
                
                const response = await fetch(`${this.apiBase}/rides/search?${queryParams}`, {
                    headers: auth.getAuthHeaders()
                });

                const data = await response.json();
                console.log('Search rides response:', data);

                if (!response.ok) {
                    throw new Error(data.message || 'Failed to search rides');
                }

                return data;
            } catch (error) {
                console.error('Search rides error:', error);
                throw error;
            }
        }

        async bookRide(rideId, bookingData) {
            try {
                const response = await fetch(`${this.apiBase}/rides/${rideId}/book`, {
                    method: 'POST',
                    headers: auth.getAuthHeaders(),
                    body: JSON.stringify(bookingData)
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'Failed to book ride');
                }

                return data;
            } catch (error) {
                console.error('Book ride error:', error);
                throw error;
            }
        }

        async getMyRides() {
            try {
                const data = await auth.apiRequest('/rides/my-rides');
                return data;
            } catch (error) {
                console.error('Get my rides error:', error);
                throw error;
            }
        }

        async getMyBookings() {
            try {
                const data = await auth.apiRequest('/rides/my-bookings');
                return data;
            } catch (error) {
                console.error('Get my bookings error:', error);
                throw error;
            }
        }

        async triggerSOS(location) {
            try {
                const response = await fetch(`${this.apiBase}/emergency/sos`, {
                    method: 'POST',
                    headers: auth.getAuthHeaders(),
                    body: JSON.stringify({ location })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'Failed to trigger SOS');
                }

                return data;
            } catch (error) {
                console.error('SOS error:', error);
                throw error;
            }
        }
    }

    // Map Manager Class using Leaflet (OpenStreetMap)
    class MapManager {
        constructor() {
            this.map = null;
            this.markers = [];
        }

        initMap() {
            // Default location: Amravati, Maharashtra
            const amravati = [20.9374, 77.7796];
            
            try {
                // Hide placeholder
                document.getElementById('map-placeholder').style.display = 'none';
                
                this.map = L.map('map').setView(amravati, 12);

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 18
                }).addTo(this.map);

                // Add a default marker for Amravati
                this.addMarker(amravati, 'Amravati, Maharashtra', 'default');
                
                console.log('Leaflet map initialized successfully');
            } catch (error) {
                console.error('Error initializing map:', error);
                this.showMapError();
            }
        }

        addMarker(coords, title, type = 'default') {
            let markerColor = 'blue';
            let iconHtml = 'üìç';
            
            switch(type) {
                case 'start':
                    markerColor = 'green';
                    iconHtml = 'üü¢';
                    break;
                case 'end':
                    markerColor = 'red';
                    iconHtml = 'üî¥';
                    break;
                case 'ride':
                    markerColor = 'blue';
                    iconHtml = 'üöó';
                    break;
                default:
                    markerColor = 'blue';
                    iconHtml = 'üìç';
            }

            // Create a custom icon
            const customIcon = L.divIcon({
                html: `<div style="font-size: 24px;">${iconHtml}</div>`,
                className: 'custom-marker',
                iconSize: [30, 30],
                iconAnchor: [15, 30]
            });

            const marker = L.marker(coords, { icon: customIcon }).addTo(this.map);
            
            marker.bindPopup(`
                <div style="padding: 10px; min-width: 200px;">
                    <h3 style="margin: 0 0 8px 0; color: #0f172a;">${title}</h3>
                    <p style="margin: 4px 0; color: #64748b;">Location: ${coords[0].toFixed(4)}, ${coords[1].toFixed(4)}</p>
                    ${type === 'ride' ? '<button onclick="bookRideFromMap()" style="background: #14b8a6; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-top: 8px;">Book Ride</button>' : ''}
                </div>
            `);

            this.markers.push(marker);
            return marker;
        }

        clearMarkers() {
            this.markers.forEach(marker => {
                this.map.removeLayer(marker);
            });
            this.markers = [];
        }

        fitBoundsToMarkers() {
            if (this.markers.length === 0) return;

            const group = new L.featureGroup(this.markers);
            this.map.fitBounds(group.getBounds().pad(0.1));
        }

        showMapError() {
            document.getElementById('map-placeholder').style.display = 'flex';
            document.getElementById('map-placeholder').innerHTML = `
                <div class="map-icon">‚ö†Ô∏è</div>
                <p><strong>Map Loading Issue</strong></p>
                <p>We're having trouble loading the map. Please check your internet connection.</p>
                <small>Using fallback map service</small>
            `;
        }

        // Geocoding function to convert address to coordinates
        async geocodeAddress(address) {
            try {
                // Using OpenStreetMap Nominatim API for geocoding
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1`);
                const data = await response.json();
                
                if (data && data.length > 0) {
                    return [parseFloat(data[0].lat), parseFloat(data[0].lon)];
                }
                return null;
            } catch (error) {
                console.error('Geocoding error:', error);
                return null;
            }
        }
    }

    // Create global instances
    const auth = new Auth();
    const rideManager = new RideManager();
    const mapManager = new MapManager();

    // Auth Functions
    function switchAuthTab(tab) {
        console.log('Switching to tab:', tab);
        document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
        
        document.querySelector(`.auth-tab[onclick="switchAuthTab('${tab}')"]`).classList.add('active');
        document.getElementById(`${tab}-form`).classList.add('active');
    }

    async function handleLogin(e) {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        
        if (!email || !password) {
            showNotification('Please fill in all fields', 'warning');
            return;
        }
        
        try {
            const result = await auth.login(email, password);
            showNotification('Login successful!', 'success');
            showApp();
        } catch (error) {
            showNotification(error.message, 'error');
        }
    }

    async function handleSignup(e) {
        e.preventDefault();
        const name = document.getElementById('signup-name').value;
        const email = document.getElementById('signup-email').value;
        const phone = document.getElementById('signup-phone').value;
        const workplace = document.getElementById('signup-workplace').value;
        const password = document.getElementById('signup-password').value;
        const confirmPassword = document.getElementById('signup-confirm-password').value;
        
        // Emergency contacts
        const emergencyContacts = [];
        
        const contact1 = {
            name: document.getElementById('emergency1-name').value,
            phone: document.getElementById('emergency1-phone').value,
            relationship: document.getElementById('emergency1-relation').value
        };
        
        if (contact1.name && contact1.phone && contact1.relationship) {
            emergencyContacts.push(contact1);
        }
        
        const contact2 = {
            name: document.getElementById('emergency2-name').value,
            phone: document.getElementById('emergency2-phone').value,
            relationship: document.getElementById('emergency2-relation').value
        };
        
        if (contact2.name && contact2.phone && contact2.relationship) {
            emergencyContacts.push(contact2);
        }
        
        if (!name || !email || !phone || !workplace || !password || !confirmPassword) {
            showNotification('Please fill in all required fields', 'warning');
            return;
        }
        
        if (password !== confirmPassword) {
            showNotification('Passwords do not match', 'error');
            return;
        }
        
        if (emergencyContacts.length === 0) {
            showNotification('Please add at least one emergency contact', 'warning');
            return;
        }
        
        try {
            const result = await auth.register({
                name,
                email,
                phone,
                workplace,
                password,
                emergencyContacts
            });
            
            showNotification('Account created successfully!', 'success');
            showApp();
        } catch (error) {
            showNotification(error.message, 'error');
        }
    }

    function logout() {
        auth.logout();
        
        document.getElementById('auth-page').style.display = 'block';
        document.querySelector('header').style.display = 'none';
        document.querySelector('.main').style.display = 'none';
        document.querySelector('.sos-btn').style.display = 'none';
        document.querySelector('footer').style.display = 'none';
        
        document.getElementById('login-form').reset();
        document.getElementById('signup-form').reset();
    }

    function showApp() {
        document.getElementById('auth-page').style.display = 'none';
        document.querySelector('header').style.display = 'block';
        document.querySelector('.main').style.display = 'block';
        document.querySelector('.sos-btn').style.display = 'block';
        document.querySelector('footer').style.display = 'block';
        
        loadUserData();
        setDefaultSearchDate();
        setDefaultOfferDate();
    }

    async function loadUserData() {
        if (!auth.isAuthenticated()) return;
        
        try {
            const user = await auth.getCurrentUser();
            if (user) {
                currentUser = user;
                
                document.getElementById('profile-name').textContent = currentUser.name;
                document.getElementById('profile-email').textContent = currentUser.email;
                document.getElementById('profile-workplace').textContent = currentUser.workplace;
                document.getElementById('profile-phone').textContent = currentUser.phone;
                
                document.getElementById('profile-name-input').value = currentUser.name;
                document.getElementById('profile-email-input').value = currentUser.email;
                document.getElementById('profile-workplace-input').value = currentUser.workplace;
                document.getElementById('profile-phone-input').value = currentUser.phone;
                
                document.getElementById('profile-offered').textContent = currentUser.ridesOffered || 0;
                document.getElementById('profile-taken').textContent = currentUser.ridesTaken || 0;
                document.getElementById('profile-saved').textContent = `‚Çπ${currentUser.moneySaved || 0}`;
                
                const avatarContainer = document.getElementById('profile-avatar-container');
                avatarContainer.innerHTML = '';
                if (currentUser.avatar) {
                    const avatarImg = document.createElement('img');
                    avatarImg.src = currentUser.avatar;
                    avatarImg.alt = currentUser.name;
                    avatarContainer.appendChild(avatarImg);
                } else {
                    const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
                    avatarContainer.textContent = initials;
                }
            }
        } catch (error) {
            console.error('Error loading user data:', error);
        }
    }

    // Theme Toggle
    function toggleTheme() {
        const body = document.body;
        const themeToggle = document.querySelector('.theme-toggle');
        
        if (body.getAttribute('data-theme') === 'dark') {
            body.removeAttribute('data-theme');
            themeToggle.textContent = 'üåô';
            localStorage.setItem('theme', 'light');
        } else {
            body.setAttribute('data-theme', 'dark');
            themeToggle.textContent = '‚òÄÔ∏è';
            localStorage.setItem('theme', 'dark');
        }
    }

    // Load saved theme
    function loadTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.setAttribute('data-theme', 'dark');
            document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
        }
    }

    // Mobile Menu Toggle
    function toggleMobileMenu() {
        const navLinks = document.getElementById('nav-links');
        navLinks.classList.toggle('show');
    }

    // Page Navigation
    function showPage(pageId) {
        console.log('Showing page:', pageId);
        // Hide all pages
        document.querySelectorAll('.page').forEach(page => {
            page.classList.remove('active');
        });
        
        // Show selected page
        const targetPage = document.getElementById(pageId);
        if (targetPage) {
            targetPage.classList.add('active');
            
            // Close mobile menu if open
            document.getElementById('nav-links').classList.remove('show');
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            // Initialize map when find-ride page is shown
            if (pageId === 'find-ride' && !mapManager.map) {
                setTimeout(() => {
                    mapManager.initMap();
                }, 100);
            }
        }
    }

    // Set default dates
    function setDefaultSearchDate() {
        const dateInput = document.getElementById('search-date');
        if (dateInput) {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            dateInput.value = tomorrow.toISOString().split('T')[0];
        }
    }

    function setDefaultOfferDate() {
        const dateInput = document.getElementById('offer-date');
        if (dateInput) {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            dateInput.value = tomorrow.toISOString().split('T')[0];
        }
    }

    // Load and display available rides from database
    async function loadAvailableRides() {
        if (!auth.isAuthenticated()) {
            displayRides([]);
            return;
        }

        try {
            // Get search parameters from form
            const from = document.getElementById('search-from')?.value;
            const to = document.getElementById('search-to')?.value;
            const date = document.getElementById('search-date')?.value;

            if (!from || !to || !date) {
                displayRides([]);
                updateRidesCount(0);
                return;
            }

            const searchParams = {
                from,
                to,
                date,
                maxPrice: document.getElementById('filter-price')?.value || '',
                vehicleType: document.getElementById('filter-vehicle')?.value || '',
                seats: 1
            };

            const result = await rideManager.searchRides(searchParams);
            
            if (result.success) {
                currentRides = result.data || [];
                filteredRides = [...currentRides];
                displayRides(filteredRides);
                updateRidesCount(filteredRides.length);
                
                // Update map with ride locations
                updateMapWithRides(from, to);
            } else {
                displayRides([]);
                updateRidesCount(0);
            }
        } catch (error) {
            console.error('Error loading rides:', error);
            displayRides([]);
            updateRidesCount(0);
            showNotification('Error loading rides', 'error');
        }
    }

    // Update map with ride locations
    async function updateMapWithRides(from, to) {
        if (!mapManager.map) return;
        
        // Clear existing markers
        mapManager.clearMarkers();
        
        try {
            // Add markers for start and end points
            const fromCoords = await mapManager.geocodeAddress(from) || [20.9374, 77.7796];
            const toCoords = await mapManager.geocodeAddress(to) || [20.9374, 77.7796];
            
            mapManager.addMarker(fromCoords, 'Start: ' + from, 'start');
            mapManager.addMarker(toCoords, 'End: ' + to, 'end');
            
            // Add markers for available rides
            for (const ride of filteredRides) {
                const rideLocation = ride.from?.name || ride.from?.address || from;
                const rideCoords = await mapManager.geocodeAddress(rideLocation) || fromCoords;
                
                const marker = mapManager.addMarker(rideCoords, 
                    `${ride.driver?.name || 'Driver'}: ${ride.from?.name || 'Unknown'} ‚Üí ${ride.to?.name || 'Unknown'}`,
                    'ride'
                );
                
                // Store ride ID in marker for reference
                marker.rideId = ride._id;
            }
            
            // Fit map to show all markers
            setTimeout(() => {
                mapManager.fitBoundsToMarkers();
            }, 500);
            
        } catch (error) {
            console.error('Error updating map:', error);
        }
    }

    // Create ride card HTML
    function createRideCard(ride) {
        const card = document.createElement('div');
        card.className = 'ride-card fade-in';
        
        const amenitiesHtml = (ride.amenities || []).map(amenity => 
            `<span class="amenity-tag">${amenity}</span>`
        ).join('');

        const driverInitials = ride.driver?.name?.split(' ').map(n => n[0]).join('') || 'D';

        card.innerHTML = `
            <div class="ride-header">
                <div>
                    <div class="ride-route">${ride.from?.name || ride.from?.address || 'Unknown'} ‚Üí ${ride.to?.name || ride.to?.address || 'Unknown'}</div>
                    <div class="ride-time">${new Date(ride.date).toLocaleDateString()} at ${ride.departureTime}</div>
                </div>
                <div class="ride-price">‚Çπ${ride.pricePerSeat}</div>
            </div>
            
            <div class="ride-details">
                <div class="ride-detail">
                    <div class="ride-detail-label">Vehicle Type</div>
                    <div class="ride-detail-value">${ride.vehicleType}</div>
                </div>
                <div class="ride-detail">
                    <div class="ride-detail-label">Available Seats</div>
                    <div class="ride-detail-value">${ride.availableSeats} seats</div>
                </div>
                <div class="ride-detail">
                    <div class="ride-detail-label">Vehicle No.</div>
                    <div class="ride-detail-value">${ride.vehicleNumber}</div>
                </div>
            </div>
            
            <div class="driver-info">
                <div class="driver-avatar">${driverInitials}</div>
                <div>
                    <div class="driver-details">
                        <h4>${ride.driver?.name || 'Unknown Driver'} <span class="verified-badge">‚úì Verified</span></h4>
                        <div class="driver-meta">
                            <div class="rating">‚≠ê ${ride.driver?.rating || '5.0'}</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="amenities">
                ${amenitiesHtml}
            </div>
            
            <div class="ride-actions">
                <div class="ride-actions-left">
                    <button class="btn btn-sm btn-secondary" onclick="viewRideDetails('${ride._id}')">View Details</button>
                    <button class="btn btn-sm btn-secondary" onclick="contactDriver('${ride._id}')">Contact</button>
                </div>
                <button class="btn btn-primary" onclick="bookRide('${ride._id}')">Book Ride</button>
            </div>
        `;
        
        return card;
    }

    // Display rides
    function displayRides(rides) {
        const ridesContainer = document.getElementById('rides-list');
        if (!ridesContainer) return;
        
        ridesContainer.innerHTML = '';

        if (rides.length === 0) {
            ridesContainer.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üöó</div>
                    <h3>No rides found</h3>
                    <p>Try adjusting your search criteria or check back later for new rides.</p>
                    <p><small>Make sure you've entered "From", "To", and "Date" in the search form above.</small></p>
                </div>
            `;
            return;
        }

        rides.forEach(ride => {
            const rideCard = createRideCard(ride);
            ridesContainer.appendChild(rideCard);
        });
    }

    // Update rides count
    function updateRidesCount(count) {
        const countElement = document.getElementById('rides-count');
        if (countElement) {
            countElement.textContent = `${count} ride${count !== 1 ? 's' : ''} found`;
        }
    }

    // Apply filters
    function applyFilters() {
        const vehicleType = document.getElementById('filter-vehicle')?.value.toLowerCase() || '';
        const maxPrice = parseInt(document.getElementById('filter-price')?.value) || Infinity;

        filteredRides = currentRides.filter(ride => {
            const matchesVehicle = !vehicleType || ride.vehicleType.toLowerCase().includes(vehicleType);
            const matchesPrice = ride.pricePerSeat <= maxPrice;

            return matchesVehicle && matchesPrice;
        });

        displayRides(filteredRides);
        updateRidesCount(filteredRides.length);
        
        // Update map with filtered rides
        const from = document.getElementById('search-from')?.value;
        const to = document.getElementById('search-to')?.value;
        if (from && to) {
            updateMapWithRides(from, to);
        }
        
        showNotification(`Applied filters - ${filteredRides.length} rides match your criteria`, 'success');
    }

    // Clear filters
    function clearFilters() {
        document.getElementById('filter-vehicle').value = '';
        document.getElementById('filter-price').value = '';
        
        filteredRides = [...currentRides];
        displayRides(filteredRides);
        updateRidesCount(filteredRides.length);
        
        // Update map with all rides
        const from = document.getElementById('search-from')?.value;
        const to = document.getElementById('search-to')?.value;
        if (from && to) {
            updateMapWithRides(from, to);
        }
        
        showNotification('Filters cleared', 'info');
    }

    // Sort rides
    function sortRides() {
        const sortBy = document.getElementById('sort-rides')?.value;
        
        if (!sortBy) return;

        let sortedRides = [...filteredRides];

        switch (sortBy) {
            case 'price-low':
                sortedRides.sort((a, b) => a.pricePerSeat - b.pricePerSeat);
                break;
            case 'price-high':
                sortedRides.sort((a, b) => b.pricePerSeat - a.pricePerSeat);
                break;
            case 'time':
                sortedRides.sort((a, b) => a.departureTime.localeCompare(b.departureTime));
                break;
            case 'rating':
                sortedRides.sort((a, b) => (b.driver?.rating || 0) - (a.driver?.rating || 0));
                break;
        }

        displayRides(sortedRides);
    }

    // Book ride function
    async function bookRide(rideId) {
        if (!auth.isAuthenticated()) {
            showNotification('Please log in to book a ride', 'warning');
            return;
        }
        
        try {
            const result = await rideManager.bookRide(rideId, {
                seats: 1,
                pickupPoint: 'Main pickup point'
            });
            
            showNotification('üéâ Ride booked successfully! Driver will contact you soon.', 'success');
            
            // Refresh the rides list
            loadAvailableRides();
        } catch (error) {
            showNotification(error.message, 'error');
        }
    }

    // Book ride from map
    function bookRideFromMap() {
        showNotification('Click "Book Ride" on the ride card to book this ride', 'info');
    }

    // View ride details
    async function viewRideDetails(rideId) {
        try {
            const ride = currentRides.find(r => r._id === rideId);
            if (!ride) {
                showNotification('Ride not found', 'error');
                return;
            }
            
            const details = `
                Route: ${ride.from?.name || ride.from?.address || 'Unknown'} ‚Üí ${ride.to?.name || ride.to?.address || 'Unknown'}
                Date & Time: ${new Date(ride.date).toLocaleDateString()} at ${ride.departureTime}
                Driver: ${ride.driver?.name || 'Unknown'} (‚≠ê ${ride.driver?.rating || '5.0'})
                Vehicle: ${ride.vehicleType} (${ride.vehicleNumber})
                Available Seats: ${ride.availableSeats}
                Price: ‚Çπ${ride.pricePerSeat} per seat
                Amenities: ${(ride.amenities || []).join(', ')}
                Contact: ${ride.driver?.phone || 'Contact driver for details'}
            `;
            
            alert(details);
        } catch (error) {
            showNotification('Error loading ride details', 'error');
        }
    }

    // Contact driver
    function contactDriver(rideId) {
        const ride = currentRides.find(r => r._id === rideId);
        if (!ride) {
            showNotification('Ride not found', 'error');
            return;
        }
        
        showNotification(`üìû Opening contact for ${ride.driver?.name || 'the driver'}`, 'info');
        // In a real app, this would open a chat or call interface
    }

    // Share profile
    function shareProfile() {
        if (!currentUser) return;
        
        const profileData = {
            name: currentUser.name,
            workplace: currentUser.workplace,
            phone: currentUser.phone
        };
        
        if (navigator.share) {
            navigator.share({
                title: 'TripSync Profile',
                text: `Check out ${profileData.name}'s TripSync profile!`,
                url: window.location.href
            }).catch(console.error);
        } else {
            // Fallback for browsers without native sharing
            const shareText = `Check out ${profileData.name}'s TripSync profile: ${window.location.href}`;
            navigator.clipboard.writeText(shareText).then(() => {
                showNotification('Profile link copied to clipboard!', 'success');
            });
        }
    }

    // Show notification
    function showNotification(message, type = 'info') {
        const notification = document.getElementById('notification');
        const messageEl = document.getElementById('notification-message');
        
        if (!notification || !messageEl) return;
        
        messageEl.textContent = message;
        
        // Remove existing type classes
        notification.classList.remove('success', 'warning', 'error');
        
        // Add new type class
        if (type !== 'info') {
            notification.classList.add(type);
        }
        
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 4000);
    }

    // SOS Function
    async function triggerSOS() {
        if (!auth.isAuthenticated()) {
            showNotification('Please log in to use SOS', 'warning');
            return;
        }
        
        if (confirm('üö® Are you sure you want to trigger SOS? This will alert your emergency contacts and authorities.')) {
            try {
                let location = 'Location not specified';
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            location = `https://maps.google.com/?q=${position.coords.latitude},${position.coords.longitude}`;
                            sendSOSAlert(location);
                        },
                        () => {
                            sendSOSAlert(location);
                        }
                    );
                } else {
                    sendSOSAlert(location);
                }
            } catch (error) {
                showNotification('Error triggering SOS: ' + error.message, 'error');
            }
        }
    }

    async function sendSOSAlert(location) {
        try {
            const result = await rideManager.triggerSOS(location);
            showNotification('üö® SOS Alert sent! Emergency contacts have been notified.', 'error');
            
            console.log('SOS Triggered - Actions taken:');
            console.log('1. Location shared with emergency contacts');
            console.log('2. Notifications sent to registered contacts');
            console.log('3. Emergency alert logged');
        } catch (error) {
            showNotification('Error sending SOS: ' + error.message, 'error');
        }
    }

    // Search form handler
    async function handleSearchForm(e) {
        e.preventDefault();
        const from = document.getElementById('search-from').value;
        const to = document.getElementById('search-to').value;
        const date = document.getElementById('search-date').value;
        const time = document.getElementById('search-time').value;
        
        if (!from || !to || !date || !time) {
            showNotification('Please fill in all search fields', 'warning');
            return;
        }
        
        showNotification('üîç Searching for available rides...', 'info');
        
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.classList.add('loading');
        submitBtn.textContent = 'Searching...';
        
        try {
            await loadAvailableRides();
        } catch (error) {
            showNotification(error.message, 'error');
        } finally {
            submitBtn.classList.remove('loading');
            submitBtn.textContent = 'üîç Search Rides';
        }
    }

    // Offer ride form handler
    async function handleOfferForm(e) {
        e.preventDefault();
        
        if (!auth.isAuthenticated()) {
            showNotification('Please log in to offer a ride', 'warning');
            return;
        }
        
        const fromInput = document.getElementById('offer-from').value;
        const toInput = document.getElementById('offer-to').value;
        const date = document.getElementById('offer-date').value;
        const time = document.getElementById('offer-time').value;
        const seats = document.getElementById('offer-seats').value;
        const price = document.getElementById('offer-price').value;
        const vehicle = document.getElementById('offer-vehicle').value;
        const vehicleNumber = document.getElementById('offer-vehicle-number').value;
        const notes = document.getElementById('offer-notes').value;
        
        if (!fromInput || !toInput || !date || !time || !seats || !price || !vehicle || !vehicleNumber) {
            showNotification('Please fill in all required fields', 'warning');
            return;
        }
        
        showNotification('üöó Publishing your ride...', 'info');
        
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.classList.add('loading');
        submitBtn.textContent = 'Publishing...';
        
        try {
            const rideData = {
                from: {
                    name: fromInput,
                    address: fromInput
                },
                to: {
                    name: toInput,
                    address: toInput
                },
                date,
                departureTime: time,
                availableSeats: parseInt(seats),
                pricePerSeat: parseInt(price),
                vehicleType: vehicle,
                vehicleNumber,
                additionalNotes: notes,
                amenities: ['AC', 'Non-Smoking']
            };
            
            console.log('Sending ride data:', rideData);
            
            const result = await rideManager.createRide(rideData);
            
            showNotification('‚úÖ Ride published successfully!', 'success');
            e.target.reset();
            setDefaultOfferDate();
            
            // Switch to find ride page to see the new ride
            showPage('find-ride');
            
        } catch (error) {
            showNotification(error.message, 'error');
        } finally {
            submitBtn.classList.remove('loading');
            submitBtn.textContent = 'üöó Publish Ride';
        }
    }

    // Profile form handler
    async function handleProfileForm(e) {
        e.preventDefault();
        
        if (!auth.isAuthenticated()) return;
        
        const name = document.getElementById('profile-name-input').value;
        const email = document.getElementById('profile-email-input').value;
        const phone = document.getElementById('profile-phone-input').value;
        const workplace = document.getElementById('profile-workplace-input').value;
        
        if (!name || !email || !phone || !workplace) {
            showNotification('Please fill in all fields', 'warning');
            return;
        }
        
        showNotification('üìù Updating profile...', 'info');
        
        try {
            const result = await auth.updateProfile({
                name,
                email,
                phone,
                workplace
            });
            
            showNotification('‚úÖ Profile updated successfully!', 'success');
            loadUserData();
        } catch (error) {
            showNotification(error.message, 'error');
        }
    }

    // Initialize event listeners
    function initializeEventListeners() {
        const loginForm = document.getElementById('login-form');
        if (loginForm) {
            loginForm.addEventListener('submit', handleLogin);
        }

        const signupForm = document.getElementById('signup-form');
        if (signupForm) {
            signupForm.addEventListener('submit', handleSignup);
        }

        const searchForm = document.getElementById('search-form');
        if (searchForm) {
            searchForm.addEventListener('submit', handleSearchForm);
        }

        const offerForm = document.getElementById('offer-form');
        if (offerForm) {
            offerForm.addEventListener('submit', handleOfferForm);
        }

        const profileForm = document.getElementById('profile-form');
        if (profileForm) {
            profileForm.addEventListener('submit', handleProfileForm);
        }

        document.addEventListener('click', (e) => {
            const navLinks = document.getElementById('nav-links');
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            
            if (navLinks?.classList.contains('show') && 
                !navLinks.contains(e.target) && 
                !mobileMenuBtn?.contains(e.target)) {
                navLinks.classList.remove('show');
            }
        });
    }

    // Initialize animations
    function initializeAnimations() {
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        document.querySelectorAll('.fade-in').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            observer.observe(el);
        });
    }

    // Initialize counter animations
    function initializeCounters() {
        const counters = document.querySelectorAll('[data-count]');
        setTimeout(() => {
            counters.forEach(animateCounter);
        }, 500);
    }

    function animateCounter(element) {
        const target = parseInt(element.getAttribute('data-count'));
        const duration = 2000;
        const start = performance.now();
        
        function update(currentTime) {
            const elapsed = currentTime - start;
            const progress = Math.min(elapsed / duration, 1);
            const current = Math.floor(progress * target);
            
            element.textContent = current.toLocaleString();
            
            if (progress < 1) {
                requestAnimationFrame(update);
            }
        }
        
        requestAnimationFrame(update);
    }

    // Check if user is already logged in
    function checkLoginStatus() {
        if (auth.isAuthenticated()) {
            auth.getCurrentUser().then(user => {
                if (user) {
                    currentUser = user;
                    showApp();
                }
            }).catch(() => {
                auth.clearAuth();
            });
        }
    }

    // Initialize the application
    function initializeApp() {
        console.log('üöó TripSync App Initializing...');
        
        loadTheme();
        checkLoginStatus();
        initializeEventListeners();
        initializeAnimations();
        initializeCounters();
        
        console.log('‚úÖ TripSync App Initialized Successfully');
    }

    // Start the app when DOM is loaded
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
        initializeApp();
    }

    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
            if (window.innerWidth > 768) {
                document.getElementById('nav-links')?.classList.remove('show');
            }
        }, 100);
    });

    // Expose global functions for HTML onclick handlers
    window.showPage = showPage;
    window.toggleTheme = toggleTheme;
    window.toggleMobileMenu = toggleMobileMenu;
    window.showNotification = showNotification;
    window.bookRide = bookRide;
    window.bookRideFromMap = bookRideFromMap;
    window.viewRideDetails = viewRideDetails;
    window.contactDriver = contactDriver;
    window.shareProfile = shareProfile;
    window.triggerSOS = triggerSOS;
    window.applyFilters = applyFilters;
    window.clearFilters = clearFilters;
    window.sortRides = sortRides;
    window.switchAuthTab = switchAuthTab;
    window.logout = logout;
</script>
</body>
</html>